(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{669:function(e,n,t){"use strict";function o(e){return`Annotation(${e.id})`}t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return r})),t.d(n,"d",(function(){return s})),t.d(n,"b",(function(){return a}));const r={normal:"#3366cc",abnormal:"#dc3912"},s=["#3366cc","#dc3912","#ff9900","#109618","#990099","#0099c6","#dd4477","#66aa00","#b82e2e","#316395","#994499","#22aa99","#aaaa11","#6633cc","#e67300","#8b0707","#651067","#329262","#5574a6","#3b3eac"],a=[{polygon:[[365.2266666666667,40.959999999999994],[360.96000000000004,43.519999999999996],[356.6933333333333,46.93333333333334],[353.28000000000003,50.346666666666664],[349.8666666666667,53.760000000000005],[348.16,58.879999999999995],[346.4533333333334,64.85333333333334],[345.6,70.82666666666667],[345.6,77.65333333333334],[349.0133333333334,85.33333333333333],[358.40000000000003,93.01333333333334],[371.20000000000005,98.13333333333334],[390.8266666666667,102.39999999999999],[412.16,103.25333333333334],[432.64000000000004,101.54666666666667],[444.5866666666667,98.13333333333334],[453.12,94.72000000000001],[458.24,91.30666666666666],[460.8,86.18666666666668],[461.65333333333336,82.77333333333334],[457.3866666666667,77.65333333333334],[452.2666666666667,70.82666666666667],[446.29333333333335,63.146666666666675],[443.73333333333335,58.02666666666667],[441.17333333333335,52.906666666666666],[439.4666666666667,49.49333333333334],[437.76000000000005,47.78666666666666]],label:o,dataAttrs:{"data-category":"normal"}},{polygon:[[260.2666666666667,180.9066666666667],[260.2666666666667,181.76],[256,186.0266666666667],[253.44000000000003,188.5866666666667],[250.88000000000002,192],[248.32000000000002,197.97333333333336],[245.76000000000002,204.8],[244.9066666666667,212.48000000000002],[244.9066666666667,224.42666666666668],[248.32000000000002,235.51999999999998],[257.7066666666667,246.61333333333334],[271.36,256.85333333333335],[298.6666666666667,265.38666666666666],[308.9066666666667,266.24],[331.9466666666667,264.53333333333336],[343.04,258.56],[349.8666666666667,253.44],[354.1333333333334,248.32],[356.6933333333333,242.3466666666667],[357.5466666666667,236.37333333333333],[357.5466666666667,228.69333333333333],[357.5466666666667,220.16000000000003],[354.9866666666667,211.62666666666667],[349.8666666666667,201.38666666666666],[343.8933333333334,193.70666666666665],[337.06666666666666,189.44],[328.53333333333336,186.0266666666667],[320.85333333333335,186.0266666666667],[313.17333333333335,186.88]],label:o,dataAttrs:{"data-category":"abnormal"}},{polygon:[[157.01333333333335,369.49333333333334],[157.01333333333335,369.49333333333334],[151.89333333333335,376.32],[148.48000000000002,382.29333333333335],[144.21333333333334,389.97333333333336],[138.24,405.33333333333337],[134.82666666666668,416.4266666666667],[133.12,431.7866666666667],[132.26666666666668,444.5866666666667],[133.12,454.82666666666665],[136.53333333333333,462.50666666666666],[145.06666666666666,470.18666666666667],[155.30666666666667,474.4533333333333],[169.81333333333333,477.0133333333334],[184.32000000000002,476.16],[195.41333333333336,472.7466666666667],[205.65333333333334,467.62666666666667],[211.6266666666667,463.36],[219.30666666666667,456.53333333333336],[221.86666666666667,451.41333333333336],[222.72000000000003,446.29333333333335],[222.72000000000003,439.4666666666667],[221.01333333333335,430.08],[216.74666666666667,418.9866666666667],[212.48000000000002,409.6],[207.36,401.06666666666666],[200.53333333333336,394.24],[193.70666666666668,389.12],[187.73333333333335,385.70666666666665]],label:o,dataAttrs:{"data-category":"normal"}},{polygon:[[104.96000000000001,89.60000000000001],[104.10666666666667,89.60000000000001],[97.28,91.30666666666666],[91.30666666666667,93.01333333333334],[86.18666666666667,94.72000000000001],[79.36,98.13333333333334],[71.68,103.25333333333334],[65.70666666666668,109.22666666666667],[61.440000000000005,113.49333333333333],[58.88,121.17333333333333],[58.02666666666667,129.70666666666665],[60.58666666666667,145.06666666666666],[64,151.04000000000002],[73.38666666666667,162.98666666666668],[96.42666666666668,179.2],[115.2,186.88],[134.82666666666668,191.1466666666667],[155.30666666666667,191.1466666666667],[168.10666666666668,188.5866666666667],[178.34666666666666,186.0266666666667],[186.88000000000002,180.9066666666667],[191.14666666666668,175.7866666666667],[193.70666666666668,169.81333333333333],[194.56,163.84000000000003],[194.56,158.72000000000003],[194.56,151.89333333333332],[193.70666666666668,146.77333333333337],[192,140.8],[192,139.09333333333336],[190.29333333333335,133.97333333333336]],label:o,dataAttrs:{"data-category":"normal"}},{polygon:[[249.17333333333335,-17.06666666666667],[246.61333333333334,-17.06666666666667],[232.10666666666668,-12.800000000000004],[221.01333333333335,-9.38666666666667],[208.21333333333334,-5.1200000000000045],[198.82666666666668,0],[192,5.119999999999997],[187.73333333333335,10.240000000000002],[185.17333333333335,15.36],[183.46666666666667,23.040000000000006],[183.46666666666667,34.13333333333334],[183.46666666666667,46.93333333333334],[186.02666666666667,64.85333333333334],[190.29333333333335,76.8],[197.97333333333336,86.18666666666668],[207.36,93.01333333333334],[221.86666666666667,97.28000000000002],[238.08,98.98666666666666],[256.85333333333335,98.13333333333334],[271.36,93.86666666666666],[284.16,87.89333333333333],[296.96000000000004,80.21333333333334],[306.3466666666667,72.53333333333333],[310.61333333333334,67.41333333333334],[313.17333333333335,60.58666666666667],[314.0266666666667,54.61333333333333],[314.0266666666667,44.373333333333335],[312.32,35.84],[308.9066666666667,25.599999999999994],[306.3466666666667,17.066666666666663],[304.64000000000004,7.68],[303.7866666666667,1.7066666666666634],[302.93333333333334,-2.5600000000000023],[302.08000000000004,-5.973333333333336]],label:o,dataAttrs:{"data-category":"abnormal"}},{polygon:[[320,363.52],[318.29333333333335,363.52],[314.0266666666667,365.2266666666667],[308.05333333333334,367.7866666666667],[300.37333333333333,374.61333333333334],[291.84000000000003,381.44],[287.5733333333333,389.12],[285.0133333333334,395.94666666666666],[284.16,401.92],[284.16,407.04],[287.5733333333333,414.72],[295.25333333333333,423.25333333333333],[305.49333333333334,432.64],[318.29333333333335,441.17333333333335],[329.3866666666667,446.29333333333335],[344.74666666666667,449.7066666666667],[353.28000000000003,450.56],[360.96000000000004,450.56],[366.93333333333334,448],[374.61333333333334,444.5866666666667],[380.5866666666667,441.17333333333335],[384.85333333333335,437.76],[389.12,433.49333333333334],[391.68,426.6666666666667],[392.53333333333336,416.4266666666667],[393.3866666666667,401.92],[393.3866666666667,391.68],[390.8266666666667,382.29333333333335],[388.2666666666667,377.17333333333335],[384.85333333333335,372.9066666666667],[379.73333333333335,371.2],[374.61333333333334,370.3466666666667],[367.7866666666667,370.3466666666667],[358.40000000000003,370.3466666666667],[354.9866666666667,370.3466666666667]],label:o,dataAttrs:{"data-category":"abnormal"}},{polygon:[[410.4533333333334,273.06666666666666],[407.04,273.92],[401.92,275.62666666666667],[397.65333333333336,276.48],[395.09333333333336,278.18666666666667],[392.53333333333336,279.04],[389.97333333333336,281.6],[388.2666666666667,284.16],[386.56,289.28000000000003],[384.85333333333335,296.1066666666667],[383.1466666666667,306.3466666666667],[381.44,318.29333333333335],[380.5866666666667,327.68],[381.44,333.65333333333336],[385.7066666666667,337.92],[392.53333333333336,342.18666666666667],[401.92,345.6],[414.72,349.0133333333333],[427.52000000000004,349.8666666666667],[438.61333333333334,349.8666666666667],[446.29333333333335,347.3066666666667],[453.12,344.74666666666667],[456.53333333333336,341.3333333333333],[459.9466666666667,337.06666666666666],[461.65333333333336,332.8],[463.36,327.68],[464.21333333333337,321.70666666666665],[465.0666666666667,314.88],[465.92,307.2],[465.92,302.08],[465.92,296.96],[465.92,292.6933333333333],[465.0666666666667,289.28000000000003],[463.36,285.0133333333333],[461.65333333333336,281.6],[458.24,277.3333333333333],[454.8266666666667,274.7733333333333],[450.56,271.36],[447.1466666666667,269.6533333333333],[444.5866666666667,267.94666666666666],[442.88000000000005,267.09333333333336],[440.32000000000005,267.09333333333336]],label:o,dataAttrs:{"data-category":"normal"}},{polygon:[[95.57333333333334,251.73333333333335],[89.60000000000001,255.14666666666665],[82.77333333333334,261.12],[75.94666666666667,267.94666666666666],[72.53333333333333,273.92],[69.97333333333334,279.8933333333333],[69.12,285.0133333333333],[69.12,290.9866666666667],[69.97333333333334,298.6666666666667],[75.94666666666667,308.05333333333334],[82.77333333333334,315.73333333333335],[93.01333333333334,323.41333333333336],[106.66666666666667,330.24],[120.32000000000001,332.8],[134.82666666666668,333.65333333333336],[157.86666666666667,330.24],[174.08,323.41333333333336],[183.46666666666667,317.44],[193.70666666666668,310.61333333333334],[201.38666666666668,303.7866666666667],[205.65333333333334,297.81333333333333],[207.36,291.84],[208.21333333333334,283.3066666666667],[205.65333333333334,273.92],[197.97333333333336,262.82666666666665],[188.58666666666667,251.73333333333335],[180.05333333333334,244.90666666666664],[169.81333333333333,238.07999999999998],[161.28,233.81333333333333],[154.45333333333335,231.25333333333333],[149.33333333333334,230.39999999999998],[145.06666666666666,230.39999999999998]],label:o,dataAttrs:{"data-category":"normal"}},{polygon:[[31.573333333333334,365.2266666666667],[30.720000000000002,365.2266666666667],[27.30666666666667,368.64],[24.74666666666667,372.9066666666667],[19.62666666666667,380.5866666666667],[15.360000000000001,387.41333333333336],[11.946666666666667,395.09333333333336],[10.24,403.62666666666667],[9.386666666666667,410.4533333333333],[9.386666666666667,417.28000000000003],[11.093333333333334,422.40000000000003],[17.92,427.52000000000004],[30.720000000000002,433.49333333333334],[45.22666666666667,435.2],[55.46666666666667,435.2],[65.70666666666668,434.3466666666667],[74.24000000000001,430.08],[81.92,424.96000000000004],[87.04,419.84000000000003],[90.45333333333333,414.72],[92.16000000000001,409.6],[93.01333333333334,403.62666666666667],[93.01333333333334,395.94666666666666],[90.45333333333333,388.26666666666665],[86.18666666666667,381.44],[81.92,375.4666666666667],[75.09333333333333,370.3466666666667],[63.14666666666667,364.37333333333333],[53.760000000000005,362.6666666666667],[48.64,362.6666666666667],[42.66666666666667,363.52],[40.96,364.37333333333333],[36.693333333333335,366.08]],label:o,dataAttrs:{"data-category":"abnormal"}}]},670:function(e,n,t){"use strict";t.r(n),n.default="import { ColorProperty } from 'csstype';\nimport { css } from 'styled-components';\n\nexport interface InsightViewerCSSProperties {\n  '--contour-viewer-color'?: ColorProperty;\n  '--contour-viewer-focused-color'?: ColorProperty;\n  '--contour-viewer-stroke-width'?: ColorProperty;\n  '--contour-viewer-focused-stroke-width'?: ColorProperty;\n  '--contour-viewer-fill-color'?: ColorProperty;\n  '--contour-viewer-focused-fill-color'?: ColorProperty;\n\n  '--contour-drawer-color'?: ColorProperty;\n  '--contour-drawer-stroke-width'?: ColorProperty;\n  '--contour-drawer-fill-color'?: ColorProperty;\n\n  '--pin-color'?: ColorProperty;\n  '--pin-focused-color'?: ColorProperty;\n}\n\nexport const blockStyle = css`\n  --contour-viewer-color: #ffffff;\n  --contour-viewer-focused-color: rgb(255, 194, 17);\n  --contour-viewer-stroke-width: 3px;\n  --contour-viewer-focused-stroke-width: 6px;\n  --contour-viewer-fill-color: rgba(0, 0, 0, 0.2);\n  --contour-viewer-focused-fill-color: rgba(0, 0, 0, 0.4);\n\n  --contour-drawer-color: rgb(255, 224, 0);\n  --contour-drawer-stroke-width: 4px;\n  --contour-drawer-fill-color: rgba(255, 224, 0, 0.2);\n\n  --pin-color: #ffffff;\n  --pin-focused-color: rgb(255, 194, 17);\n`;\n\nexport const globalStyle = css`\n  :root {\n    ${blockStyle};\n  }\n`;\n"},699:function(e,n,t){"use strict";t.r(n),n.default="import { isTouchDevice } from '@lunit/is-touch-device';\nimport React, { Component, CSSProperties } from 'react';\nimport styled from 'styled-components';\nimport { FrameConsumer } from '../context/frame';\nimport { hitTestContours } from '../geom/hitTestContours';\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\nimport { Contour, Point } from '../types';\nimport { dashStroke } from './animation/dashStroke';\n\nexport interface ContourDrawerProps<T extends Contour> extends InsightViewerGuestProps {\n  width: number;\n  height: number;\n\n  /** Contour \ub370\uc774\ud130\ub97c \uc0c1\uc18d\ubc1b\uc740 Annotation \ub370\uc774\ud130 */\n  contours: T[];\n\n  /**\n   * \uadf8\ub9ac\uae30 \uae30\ub2a5 \ud65c\uc131\ud654 \uc5ec\ubd80\n   *\n   * HTMLElement\ub85c \uc785\ub825\ud560 \uacbd\uc6b0 MouseEvent\ub97c \ud574\ub2f9 HTMLElement\ub97c \uc0ac\uc6a9\ud574\uc11c \ucc98\ub9ac\ud55c\ub2e4\n   */\n  draw: boolean | HTMLElement | null;\n\n  /**\n   * \ud2b9\uc815 Contour\uc5d0 Mouse Over \ub418\uc5c8\uc744 \ub54c\n   * focusedContour\ub97c \uacb0\uc815\ud558\ub294\ub370 \ud544\uc694\ud558\ub2e4\n   */\n  onFocus: (contour: T | null) => void;\n\n  /** \uadf8\ub9ac\uae30\uac00 \uc644\ub8cc\ub418\uc5b4 \uc0c8\ub85c\uc6b4 Contour\uac00 \ubc1c\uc0dd\ud588\uc744 \ub54c */\n  onAdd: (polygon: Point[], event: MouseEvent | TouchEvent) => void;\n\n  /** \ud2b9\uc815 Contour\ub97c Click \ud574\uc11c \uc9c0\uc6b8\ub54c \ud544\uc694\ud558\ub2e4 */\n  onRemove: (contour: T) => void;\n\n  className?: string;\n  style?: CSSProperties;\n\n  /** \uadf8\ub9ac\ub294 \uacfc\uc815\uc5d0\uc11c Line\uc5d0 \ud45c\ud604\ub418\ub294 Animation\uc744 \ube44\ud65c\uc131 \uc2dc\ud0ac \uc218 \uc788\ub2e4 */\n  animateStroke?: boolean;\n\n  /**\n   * \uc811\uadfc Device \uc124\uc815\n   */\n  device?: 'all' | 'mouse-only' | 'touch-only' | 'stylus-only' | 'mouse-and-stylus';\n}\n\ninterface ContourDrawerState {\n  polygon: Point[];\n}\n\nfunction toLocal(element: HTMLElement, polygon: Point[]): string {\n  return polygon\n    .map(([x, y]) => {\n      const p = cornerstone.pixelToCanvas(element, { x, y });\n      return p.x + ',' + p.y;\n    })\n    .join(' ');\n}\n\nexport class ContourDrawerBase<T extends Contour> extends Component<ContourDrawerProps<T>, ContourDrawerState> {\n  static defaultProps: Partial<ContourDrawerProps<Contour>> = {\n    device: 'all',\n  };\n\n  private svg: SVGSVGElement | null = null;\n  private element: HTMLElement | null = null;\n  private focused: T | null = null;\n  private preventClickEvent: boolean = false;\n  private startX: number = 0;\n  private startY: number = 0;\n\n  private contentWindow: Window = window;\n\n  constructor(props: ContourDrawerProps<T>) {\n    super(props);\n\n    this.state = {\n      polygon: [],\n    };\n  }\n\n  render() {\n    return (\n      <>\n        <FrameConsumer stateRef={({ contentWindow }) => (this.contentWindow = contentWindow)} />\n        <svg\n          ref={this.svgRef}\n          role=\"figure\"\n          width={this.props.width}\n          height={this.props.height}\n          className={this.props.className}\n          style={this.props.style}\n        >\n          {this.props.cornerstoneRenderData && this.state.polygon && this.state.polygon.length > 0 && (\n            <>\n              <polyline points={toLocal(this.props.cornerstoneRenderData.element, this.state.polygon)} />\n              {this.props.animateStroke !== false && (\n                <polyline\n                  points={toLocal(this.props.cornerstoneRenderData.element, this.state.polygon)}\n                  data-highlight=\"highlight\"\n                />\n              )}\n            </>\n          )}\n        </svg>\n      </>\n    );\n  }\n\n  svgRef = (svg: SVGSVGElement) => {\n    if (svg && this.svg && this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n\n      if (this.canActivate(this.props)) {\n        this.svg = svg;\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n\n    this.svg = svg;\n  };\n\n  componentDidMount() {\n    if (!this.svg) throw new Error('<svg> is not initialized');\n\n    if (this.canActivate(this.props)) {\n      this.element = this.getElement(this.props);\n      this.activateInitialEvents();\n    }\n  }\n\n  componentDidUpdate(prevProps: Readonly<ContourDrawerProps<T>>) {\n    if (prevProps.draw !== this.props.draw) {\n      if (this.element) {\n        this.deactivateInitialEvents();\n        this.deactivateMouseDrawEvents();\n      }\n\n      if (this.canActivate(this.props)) {\n        this.element = this.getElement(this.props);\n        this.activateInitialEvents();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.element) {\n      this.deactivateInitialEvents();\n      this.deactivateMouseDrawEvents();\n    }\n  }\n\n  getElement = ({ draw }: Readonly<ContourDrawerProps<T>>): HTMLElement => {\n    //@ts-ignore\n    return draw instanceof this.contentWindow['HTMLElement'] ? (draw as HTMLElement) : (this.svg as HTMLElement);\n  };\n\n  canActivate = ({ draw }: Readonly<ContourDrawerProps<T>>) => {\n    return draw instanceof this.contentWindow['HTMLElement'] || draw === true;\n  };\n\n  // ---------------------------------------------\n  // initial events\n  // ---------------------------------------------\n  activateInitialEvents = () => {\n    if (!this.element) return;\n    if (this.props.device !== 'touch-only' && this.props.device !== 'stylus-only') {\n      this.element.addEventListener('mousemove', this.onMouseMoveToFindFocus);\n      this.element.addEventListener('mousedown', this.onMouseDownToStartDraw);\n    }\n    if (isTouchDevice() && this.props.device !== 'mouse-only') {\n      this.element.addEventListener('touchstart', this.onTouchStartToStartDraw);\n    }\n    this.element.addEventListener('click', this.onMouseClickToRemove);\n  };\n\n  deactivateInitialEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToFindFocus);\n    this.element.removeEventListener('mousedown', this.onMouseDownToStartDraw);\n    this.element.removeEventListener('touchstart', this.onTouchStartToStartDraw);\n    this.element.removeEventListener('click', this.onMouseClickToRemove);\n  };\n\n  onMouseMoveToFindFocus = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    this.findFocus(event.pageX, event.pageY);\n  };\n\n  findFocus = (pageX: number, pageY: number) => {\n    if (!this.props.contours || this.props.contours.length === 0 || !this.props.cornerstoneRenderData) return;\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, pageX, pageY);\n\n    this.focused = hitTestContours<T>(this.props.contours, [x, y]);\n\n    this.props.onFocus(this.focused);\n  };\n\n  onMouseClickToRemove = (event: MouseEvent) => {\n    event.stopPropagation();\n\n    if (!this.focused || this.preventClickEvent) return;\n\n    this.props.onRemove(this.focused);\n  };\n\n  // ---------------------------------------------\n  // touch draw events\n  // ---------------------------------------------\n  onTouchStartToStartDraw = (event: TouchEvent) => {\n    if (\n      (this.props.device === 'stylus-only' || this.props.device === 'mouse-and-stylus') &&\n      event.targetTouches[0].touchType !== 'stylus'\n    ) {\n      return;\n    } else if (event.targetTouches.length > 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        polygon: [],\n      }));\n      return;\n    } else if (event.targetTouches.length !== 1) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData\ub97c \ucc3e\uc744 \uc218 \uc5c6\ub2e4!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.targetTouches[0].pageX;\n    this.startY = event.targetTouches[0].pageY;\n\n    this.deactivateInitialEvents();\n    this.activateTouchDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [[x, y]],\n    }));\n  };\n\n  activateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.addEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.addEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  deactivateTouchDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('touchmove', this.onTouchMoveToDraw);\n    this.element.removeEventListener('touchend', this.onTouchEndToEndDraw);\n    this.element.removeEventListener('touchcancel', this.onTouchEndToEndDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelTouchDraw);\n  };\n\n  onTouchMoveToDraw = (event: TouchEvent) => {\n    if (event.targetTouches.length !== 1 || event.changedTouches.length !== 1) {\n      this.deactivateTouchDrawEvents();\n      this.activateInitialEvents();\n      this.setState((prevState) => ({\n        ...prevState,\n        polygon: [],\n      }));\n      return;\n    }\n\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData\ub97c \ucc3e\uc744 \uc218 \uc5c6\ub2e4!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(\n        Math.abs(event.targetTouches[0].pageX - this.startX),\n        Math.abs(event.targetTouches[0].pageY - this.startY),\n      ) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.targetTouches[0].pageX, event.targetTouches[0].pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [...prevState.polygon, [x, y]],\n    }));\n  };\n\n  onTouchEndToEndDraw = (event: TouchEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    this.props.onAdd(this.state.polygon, event);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  onKeyDownToCancelTouchDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelTouchDraw();\n    }\n  };\n\n  cancelTouchDraw = () => {\n    this.deactivateTouchDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  // ---------------------------------------------\n  // mouse draw events\n  // ---------------------------------------------\n  onMouseDownToStartDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData\ub97c \ucc3e\uc744 \uc218 \uc5c6\ub2e4!');\n    }\n\n    this.preventClickEvent = false;\n    this.startX = event.pageX;\n    this.startY = event.pageY;\n\n    this.deactivateInitialEvents();\n    this.activateMouseDrawEvents();\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [[x, y]],\n    }));\n  };\n\n  activateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.addEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.addEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.addEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.addEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  deactivateMouseDrawEvents = () => {\n    if (!this.element) return;\n    this.element.removeEventListener('mousemove', this.onMouseMoveToDraw);\n    this.element.removeEventListener('mouseup', this.onMouseUpToEndDraw);\n    this.element.removeEventListener('mouseleave', this.onMouseLeaveToCancelDraw);\n    window.removeEventListener('keydown', this.onKeyDownToCancelMouseDraw);\n  };\n\n  onMouseMoveToDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    if (!this.props.cornerstoneRenderData) {\n      throw new Error('cornerstoneRenderEventData\ub97c \ucc3e\uc744 \uc218 \uc5c6\ub2e4!');\n    }\n\n    if (\n      !this.preventClickEvent &&\n      Math.max(Math.abs(event.pageX - this.startX), Math.abs(event.pageY - this.startY)) > 20\n    ) {\n      this.preventClickEvent = true;\n    }\n\n    const element: HTMLElement = this.props.cornerstoneRenderData.element;\n\n    const { x, y } = cornerstone.pageToPixel(element, event.pageX, event.pageY);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [...prevState.polygon, [x, y]],\n    }));\n  };\n\n  onMouseUpToEndDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    this.props.onAdd(this.state.polygon, event);\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n\n  onMouseLeaveToCancelDraw = (event: MouseEvent) => {\n    event.preventDefault();\n    event.stopPropagation();\n    event.stopImmediatePropagation();\n\n    this.cancelMouseDraw();\n  };\n\n  onKeyDownToCancelMouseDraw = (event: KeyboardEvent) => {\n    if (event.key.toLowerCase() === 'escape') {\n      event.preventDefault();\n      event.stopPropagation();\n      event.stopImmediatePropagation();\n\n      this.cancelMouseDraw();\n    }\n  };\n\n  cancelMouseDraw = () => {\n    this.deactivateMouseDrawEvents();\n    this.activateInitialEvents();\n\n    this.setState((prevState) => ({\n      ...prevState,\n      polygon: [],\n    }));\n  };\n}\n\n/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const ContourDrawer: new <T extends Contour>() => ContourDrawerBase<T> = styled(ContourDrawerBase)`\n  position: absolute;\n  top: 0;\n  left: 0;\n\n  --color: rgb(255, 224, 0);\n  --stroke-width: 4px;\n  --fill-color: rgba(255, 224, 0, 0.2);\n\n  > polyline:first-child {\n    stroke: var(--contour-drawer-color, var(--color));\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: var(--contour-drawer-fill-color, var(--fill-color));\n  }\n\n  > polyline[data-highlight] {\n    stroke: #ffffff;\n    stroke-width: var(--contour-drawer-stroke-width, var(--stroke-width));\n    fill: transparent;\n    ${dashStroke}\n  }\n` as any;\n\n/**\n * @deprecated use ContourDrawer instead\n */\nexport const UserContourDrawer = ContourDrawer;\n"},825:function(e,n,t){"use strict";t.r(n);var o=t(666),r=t(0),s=t.n(r),a=t(669);Object(o.installWADOImageLoader)();const i={width:[600,400,1e3],height:[700,400,1e3],control:["pen",["none","pan","pen","adjust"]],wheel:["zoom",["none","zoom"]],flip:[!1],invert:[!1]};n.default=()=>{const e=Object(r.useMemo)(()=>new o.CornerstoneSingleImage("wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm",{unload:o.unloadImage}),[]),{cornerstoneRenderData:n,updateCornerstoneRenderData:t}=Object(o.useInsightViewerSync)(),{contours:l,focusedContour:c,addContour:u,removeContour:h,focusContour:p}=Object(o.useContour)();return s.a.createElement(o.InsightViewerTestController,{options:i},({width:r,height:i,invert:d,flip:v,control:m,wheel:w,resetTime:g,element:f,setElement:C,interactions:D})=>s.a.createElement(o.InsightViewerContainer,{ref:C,width:r,height:i},s.a.createElement(o.CornerstoneViewer,{width:r,height:i,invert:d,flip:v,interactions:D,resetTime:g,image:e,updateCornerstoneRenderData:t}),l&&l.length>0&&n&&s.a.createElement(o.ContourViewer,{width:r,height:i,contours:l,focusedContour:c,cornerstoneRenderData:n}),l&&n&&"pen"===m&&s.a.createElement(o.ContourDrawer,{width:r,height:i,contours:l,draw:"pen"===m&&f,onFocus:p,onAdd:e=>u(e,{label:a.c}),onRemove:h,cornerstoneRenderData:n})))}},826:function(e,n,t){"use strict";t.r(n),n.default="import {\n  ContourDrawer,\n  ContourViewer,\n  CornerstoneImage,\n  CornerstoneSingleImage,\n  CornerstoneViewer,\n  InsightViewerContainer,\n  InsightViewerControllerOptions,\n  InsightViewerTestController,\n  installWADOImageLoader,\n  unloadImage,\n  useContour,\n  useInsightViewerSync,\n} from '@lunit/insight-viewer';\nimport React, { useMemo } from 'react';\nimport { labelFunction } from '../../../__fixtures__/contour';\n\ninstallWADOImageLoader();\n\nconst controllerOptions: InsightViewerControllerOptions = {\n  width: [600, 400, 1000],\n  height: [700, 400, 1000],\n  control: ['pen', ['none', 'pan', 'pen', 'adjust']],\n  wheel: ['zoom', ['none', 'zoom']],\n  flip: [false],\n  invert: [false],\n};\n\nexport default () => {\n  const image: CornerstoneImage = useMemo(\n    () =>\n      new CornerstoneSingleImage(`wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm`, {\n        unload: unloadImage,\n      }),\n    [],\n  );\n\n  const { cornerstoneRenderData, updateCornerstoneRenderData } = useInsightViewerSync();\n\n  // create contour data and user drawing behaviors\n  const { contours, focusedContour, addContour, removeContour, focusContour } = useContour();\n\n  return (\n    <InsightViewerTestController options={controllerOptions}>\n      {({ width, height, invert, flip, control, wheel, resetTime, element, setElement, interactions }) => (\n        <InsightViewerContainer ref={setElement} width={width} height={height}>\n          <CornerstoneViewer\n            width={width}\n            height={height}\n            invert={invert}\n            flip={flip}\n            interactions={interactions}\n            resetTime={resetTime}\n            image={image}\n            updateCornerstoneRenderData={updateCornerstoneRenderData}\n          />\n          {contours && contours.length > 0 && cornerstoneRenderData && (\n            <ContourViewer\n              width={width}\n              height={height}\n              contours={contours}\n              focusedContour={focusedContour}\n              cornerstoneRenderData={cornerstoneRenderData}\n            />\n          )}\n          {contours && cornerstoneRenderData && control === 'pen' && (\n            <ContourDrawer\n              width={width}\n              height={height}\n              contours={contours}\n              draw={control === 'pen' && element}\n              onFocus={focusContour}\n              onAdd={(contour) => addContour(contour, { label: labelFunction })}\n              onRemove={removeContour}\n              cornerstoneRenderData={cornerstoneRenderData}\n            />\n          )}\n        </InsightViewerContainer>\n      )}\n    </InsightViewerTestController>\n  );\n};\n"},827:function(e,n,t){"use strict";t.r(n);var o=t(666),r=t(669),s=t(0),a=t.n(s),i=t(36);Object(o.installWADOImageLoader)();const l={width:[600,400,1e3],height:[700,400,1e3],control:["pen",["none","pan","pen","adjust"]],wheel:["zoom",["none","zoom"]],flip:[!1],invert:[!1]},c=Object(i.d)(o.ContourDrawer)`
  --contour-drawer-color: #ff0000;
  --contour-drawer-fill-color: rgba(255, 255, 255, 0.4);
  --contour-drawer-stroke-width: 7px;
`;n.default=()=>{const e=Object(s.useMemo)(()=>new o.CornerstoneSingleImage("wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm",{unload:o.unloadImage}),[]),{cornerstoneRenderData:n,updateCornerstoneRenderData:t}=Object(o.useInsightViewerSync)(),{contours:i,focusedContour:u,addContour:h,removeContour:p,focusContour:d}=Object(o.useContour)();return a.a.createElement(o.InsightViewerTestController,{options:l},({width:s,height:l,invert:v,flip:m,control:w,wheel:g,resetTime:f,element:C,setElement:D,interactions:T})=>a.a.createElement(o.InsightViewerContainer,{ref:D,width:s,height:l},a.a.createElement(o.CornerstoneViewer,{width:s,height:l,invert:v,flip:m,interactions:T,resetTime:f,image:e,updateCornerstoneRenderData:t}),i&&i.length>0&&n&&a.a.createElement(o.ContourViewer,{width:s,height:l,contours:i,focusedContour:u,cornerstoneRenderData:n}),i&&n&&"pen"===w&&a.a.createElement(c,{width:s,height:l,contours:i,draw:"pen"===w&&C,onFocus:d,onAdd:e=>h(e,{label:r.c}),onRemove:p,cornerstoneRenderData:n})))}},828:function(e,n,t){"use strict";t.r(n),n.default="import {\n  ContourDrawer,\n  ContourViewer,\n  CornerstoneImage,\n  CornerstoneSingleImage,\n  CornerstoneViewer,\n  InsightViewerContainer,\n  InsightViewerControllerOptions,\n  InsightViewerTestController,\n  installWADOImageLoader,\n  unloadImage,\n  useContour,\n  useInsightViewerSync,\n} from '@lunit/insight-viewer';\nimport { labelFunction } from '@lunit/insight-viewer/__fixtures__/contour';\nimport React, { useMemo } from 'react';\nimport styled from 'styled-components';\n\ninstallWADOImageLoader();\n\nconst controllerOptions: InsightViewerControllerOptions = {\n  width: [600, 400, 1000],\n  height: [700, 400, 1000],\n  control: ['pen', ['none', 'pan', 'pen', 'adjust']],\n  wheel: ['zoom', ['none', 'zoom']],\n  flip: [false],\n  invert: [false],\n};\n\nconst CustomStyleDrawer = styled(ContourDrawer)`\n  --contour-drawer-color: #ff0000;\n  --contour-drawer-fill-color: rgba(255, 255, 255, 0.4);\n  --contour-drawer-stroke-width: 7px;\n`;\n\nexport default () => {\n  const image: CornerstoneImage = useMemo(\n    () =>\n      new CornerstoneSingleImage(`wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm`, {\n        unload: unloadImage,\n      }),\n    [],\n  );\n\n  const { cornerstoneRenderData, updateCornerstoneRenderData } = useInsightViewerSync();\n\n  // create contour data and user drawing behaviors\n  const { contours, focusedContour, addContour, removeContour, focusContour } = useContour();\n\n  return (\n    <InsightViewerTestController options={controllerOptions}>\n      {({ width, height, invert, flip, control, wheel, resetTime, element, setElement, interactions }) => (\n        <InsightViewerContainer ref={setElement} width={width} height={height}>\n          <CornerstoneViewer\n            width={width}\n            height={height}\n            invert={invert}\n            flip={flip}\n            interactions={interactions}\n            resetTime={resetTime}\n            image={image}\n            updateCornerstoneRenderData={updateCornerstoneRenderData}\n          />\n          {contours && contours.length > 0 && cornerstoneRenderData && (\n            <ContourViewer\n              width={width}\n              height={height}\n              contours={contours}\n              focusedContour={focusedContour}\n              cornerstoneRenderData={cornerstoneRenderData}\n            />\n          )}\n          {contours && cornerstoneRenderData && control === 'pen' && (\n            <CustomStyleDrawer\n              width={width}\n              height={height}\n              contours={contours}\n              draw={control === 'pen' && element}\n              onFocus={focusContour}\n              onAdd={(contour) => addContour(contour, { label: labelFunction })}\n              onRemove={removeContour}\n              cornerstoneRenderData={cornerstoneRenderData}\n            />\n          )}\n        </InsightViewerContainer>\n      )}\n    </InsightViewerTestController>\n  );\n};\n"},933:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return l}));t(0);var o=t(62),r=t(7),s=t(89),a=t(667);const i={};function l({components:e,...n}){return Object(o.b)("wrapper",Object.assign({},i,n,{components:e,mdxType:"MDXLayout"}),Object(o.b)("h1",null,Object(o.b)("inlineCode",{parentName:"h1"},"<ContourDrawer>")),Object(o.b)("p",null,"Annotation Tool, OPT \uc640 \uac19\uc774 \uc0ac\uc6a9\uc790\uc758 Contour Drawing\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 \uc0ac\uc6a9\ub41c\ub2e4."),Object(o.b)("p",null,"\ub2e8\uc21c\ud788 \uadf8\ub9ac\ub294 \uae30\ub2a5\ub9cc \uc788\uace0, \uadf8\ub824\uc9c4 Contour \ub370\uc774\ud130\ub4e4\uc740 ",Object(o.b)("inlineCode",{parentName:"p"},"<ContourViewer>"),"\uc5d0\uc11c \ucc98\ub9ac\ud574\uc57c \ud55c\ub2e4."),Object(o.b)("h1",null,"API"),Object(o.b)(s.Example,{example:Object(r.d)("@lunit/insight-viewer/components/ContourDrawer",{source:t(699),filename:"src/_packages/@lunit/insight-viewer/components/ContourDrawer.tsx"}),api:!0,mdxType:"Example"}),Object(o.b)("h1",null,"Sample"),Object(o.b)(s.Example,{example:Object(r.b)("./ContourDrawer/Basic",{component:t(825),source:t(826),filename:"src/_packages/@lunit/insight-viewer/__pages__/Components/ContourDrawer/Basic.tsx"}),mdxType:"Example"},Object(o.b)(a.a,{height:720,mdxType:"InsightViewerPreview"})),Object(o.b)("h1",null,"Styling"),Object(o.b)("p",null,"CSS Variable\uc744 \ud1b5\ud574\uc11c \uc0c9\uc0c1\uc744 \ubcc0\uacbd\ud560 \uc218 \uc788\ub2e4."),Object(o.b)("p",null,"\uc544\ub798 File\uc5d0\uc11c ",Object(o.b)("inlineCode",{parentName:"p"},"--contour-drawer-*"),"\uc758 \uc774\ub984\uc744 \uac00\uc9c4 \ud56d\ubaa9\ub4e4\uc5d0 \uc601\ud5a5\uc744 \ubc1b\ub294\ub2e4."),Object(o.b)(s.Example,{example:Object(r.d)("../../theme/style",{source:t(670),filename:"src/_packages/@lunit/insight-viewer/theme/style.ts"}),mdxType:"Example"}),Object(o.b)(s.Example,{example:Object(r.b)("./ContourDrawer/CustomStyle",{component:t(827),source:t(828),filename:"src/_packages/@lunit/insight-viewer/__pages__/Components/ContourDrawer/CustomStyle.tsx"}),mdxType:"Example"},Object(o.b)(a.a,{height:720,mdxType:"InsightViewerPreview"})))}l.isMDXComponent=!0}}]);
//# sourceMappingURL=13.45b5470106c6da231db7.js.map
{"version":3,"sources":["webpack:///./src/_packages/@lunit/insight-viewer/components/HeatmapViewer.tsx?019d","webpack:///./src/_packages/@lunit/insight-viewer/__pages__/Components/HeatmapViewer/Basic.tsx","webpack:///./src/_packages/@lunit/insight-viewer/__pages__/Components/HeatmapViewer/Basic.tsx?03c3","webpack:///./src/_packages/@lunit/insight-viewer/__pages__/Components/HeatmapViewer.mdx"],"names":["installWADOImageLoader","controllerOptions","width","height","control","wheel","flip","invert","image","useMemo","CornerstoneSingleImage","unload","unloadImage","cornerstoneRenderData","updateCornerstoneRenderData","useInsightViewerSync","options","resetTime","element","setElement","interactions","ref","Array","isArray","data","engine_result","pos_map","posMap","threshold","layoutProps","MDXContent","components","props","mdxType","parentName","example","source","api","component","isMDXComponent"],"mappings":"2FAAA,OAAe,+2G,iCCAf,6CAeAA,mCAEA,MAAMC,EAAoD,CACxDC,MAAO,CAAC,IAAK,IAAK,KAClBC,OAAQ,CAAC,IAAK,IAAK,KACnBC,QAAS,CAAC,MAAO,CAAC,OAAQ,MAAO,WACjCC,MAAO,CAAC,OAAQ,CAAC,OAAQ,SACzBC,KAAM,EAAC,GACPC,OAAQ,EAAC,IAGI,eACb,MAAMC,EAA0BC,kBAC9B,IACE,IAAIC,yBAAwB,wEAAwE,CAClGC,OAAQC,gBAEZ,KAGI,sBAAEC,EAAF,4BAAyBC,GAAgCC,iCAE/D,OACE,6BACE,kBAAC,8BAAD,CAA6BC,QAASf,GACnC,EAAGC,QAAOC,SAAQI,SAAQD,OAAMF,UAASC,QAAOY,YAAWC,UAASC,aAAYC,kBAC/E,kBAAC,yBAAD,CAAwBC,IAAKF,EAAYjB,MAAOA,EAAOC,OAAQA,GAC7D,kBAAC,oBAAD,CACED,MAAOA,EACPC,OAAQA,EACRI,OAAQA,EACRD,KAAMA,EACNc,aAAcA,EACdH,UAAWA,EACXT,MAAOA,EACPM,4BAA6BA,IAE9BQ,MAAMC,QAAQC,EAAKC,cAAcA,cAAcC,UAAYb,GAC1D,kBAAC,gBAAD,CACEX,MAAOA,EACPC,OAAQA,EACRwB,OAAQH,EAAKC,cAAcA,cAAcC,QACzCE,UAAW,GACXf,sBAAuBA,S,iCC1DvC,OAAe,msE,iCCCf,wFAQA,MAKMgB,EAAc,GAIL,SAASC,GAAW,WACjCC,KACGC,IAEH,OAAO,YALS,UAKT,iBAAeH,EAAiBG,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAE5E,sBAAI,0BAAYC,WAAW,MAAO,oBAClC,qBAAK,gIACL,sBAAM,OACN,YAAC,UAAD,CAASC,QAASC,YAAO,iDAAD,UAAC,KAAD,8EAAoDC,KAAG,EAACJ,QAAQ,YACxF,sBAAM,UACN,YAAC,UAAD,CAASE,QAASG,YAAU,wBAAD,aAAC,KAAD,SAAC,KAAD,8FAA2BL,QAAQ,WAChE,YAAC,IAAD,CAAsB9B,OAAQ,IAAK8B,QAAQ,2BAM7CH,EAAWS,gBAAiB","file":"36.45b5470106c6da231db7.js","sourcesContent":["export default \"import { posMapToImageData } from '@lunit/heatmap';\\nimport React, { Component, createRef, RefObject } from 'react';\\nimport styled from 'styled-components';\\nimport { InsightViewerGuestProps } from '../hooks/useInsightViewerSync';\\nimport { cleanCanvas } from './draw/cleanCanvas';\\n\\nexport interface HeatmapViewerProps extends InsightViewerGuestProps {\\n  width: number;\\n  height: number;\\n\\n  /** AI 결과로 나오는 Heatmap 데이터 형식 */\\n  posMap: number[][];\\n\\n  /** Threshold 값 (CXR = 0.15, MMG = 0.1) */\\n  threshold: number;\\n}\\n\\nexport class HeatmapViewer extends Component<HeatmapViewerProps, {}> {\\n  private canvasRef: RefObject<HTMLCanvasElement> = createRef();\\n  private ctx: CanvasRenderingContext2D | null = null;\\n  private imageData: ImageData | null = null;\\n  private imageResourceCanvas: HTMLCanvasElement | null = null;\\n\\n  render() {\\n    return (\\n      <Canvas\\n        ref={this.canvasRef}\\n        width={this.props.width}\\n        height={this.props.height}\\n        style={{\\n          width: this.props.width,\\n          height: this.props.height,\\n        }}\\n      />\\n    );\\n  }\\n\\n  componentDidMount() {\\n    this.imageResourceCanvas = document.createElement('canvas');\\n\\n    if (!this.canvasRef.current) throw new Error('<canvas> is not initialized');\\n\\n    this.ctx = this.canvasRef.current.getContext('2d');\\n\\n    if (!this.ctx) throw new Error('<canvas> context 2d is not initialized');\\n\\n    this.imageData = posMapToImageData(this.props.posMap, this.props.threshold);\\n\\n    this.drawHeatmap(this.props);\\n  }\\n\\n  componentDidUpdate(prevProps: Readonly<HeatmapViewerProps>) {\\n    const { width, height, posMap, threshold, cornerstoneRenderData } = this.props;\\n\\n    if (prevProps.posMap !== posMap || prevProps.threshold !== threshold) {\\n      this.imageData = posMapToImageData(posMap, threshold);\\n    }\\n\\n    if (\\n      prevProps.posMap !== posMap ||\\n      prevProps.threshold !== threshold ||\\n      prevProps.cornerstoneRenderData !== cornerstoneRenderData\\n    ) {\\n      cleanCanvas(this.ctx!, width, height);\\n\\n      this.drawHeatmap(this.props);\\n    }\\n  }\\n\\n  drawHeatmap = ({ cornerstoneRenderData }: Readonly<HeatmapViewerProps>) => {\\n    if (!this.imageData || !this.imageResourceCanvas || !this.ctx || !cornerstoneRenderData) {\\n      return;\\n    }\\n\\n    try {\\n      this.ctx.save();\\n\\n      this.imageResourceCanvas.width = this.imageData.width;\\n      this.imageResourceCanvas.height = this.imageData.height;\\n      this.imageResourceCanvas.getContext('2d')!.putImageData(this.imageData, 0, 0);\\n\\n      cornerstone.setToPixelCoordinateSystem(cornerstoneRenderData.enabledElement, this.ctx);\\n\\n      const imageWidth: number = cornerstoneRenderData.image.width;\\n      const imageHeight: number = cornerstoneRenderData.image.height;\\n\\n      this.ctx.drawImage(\\n        this.imageResourceCanvas,\\n        0,\\n        0,\\n        this.imageResourceCanvas.width,\\n        this.imageResourceCanvas.height,\\n        0,\\n        0,\\n        imageWidth,\\n        imageHeight,\\n      );\\n\\n      this.ctx.restore();\\n    } catch (error) {\\n      console.error(error);\\n    }\\n  };\\n}\\n\\nconst Canvas = styled.canvas`\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  pointer-events: none;\\n`;\\n\\n/**\\n * @deprecated use HeatmapViewer instead\\n */\\nexport const MachineHeatmapViewer = HeatmapViewer;\\n\"","import {\n  CornerstoneImage,\n  CornerstoneSingleImage,\n  CornerstoneViewer,\n  HeatmapViewer,\n  InsightViewerContainer,\n  InsightViewerControllerOptions,\n  InsightViewerTestController,\n  installWADOImageLoader,\n  unloadImage,\n  useInsightViewerSync,\n} from '@lunit/insight-viewer';\nimport React, { useMemo } from 'react';\nimport data from '../../../__fixtures__/posMap.sample.json';\n\ninstallWADOImageLoader();\n\nconst controllerOptions: InsightViewerControllerOptions = {\n  width: [600, 400, 1000],\n  height: [700, 400, 1000],\n  control: ['pan', ['none', 'pan', 'adjust']],\n  wheel: ['zoom', ['none', 'zoom']],\n  flip: [false],\n  invert: [false],\n};\n\nexport default () => {\n  const image: CornerstoneImage = useMemo(\n    () =>\n      new CornerstoneSingleImage(`wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm`, {\n        unload: unloadImage,\n      }),\n    [],\n  );\n\n  const { cornerstoneRenderData, updateCornerstoneRenderData } = useInsightViewerSync();\n\n  return (\n    <div>\n      <InsightViewerTestController options={controllerOptions}>\n        {({ width, height, invert, flip, control, wheel, resetTime, element, setElement, interactions }) => (\n          <InsightViewerContainer ref={setElement} width={width} height={height}>\n            <CornerstoneViewer\n              width={width}\n              height={height}\n              invert={invert}\n              flip={flip}\n              interactions={interactions}\n              resetTime={resetTime}\n              image={image}\n              updateCornerstoneRenderData={updateCornerstoneRenderData} // Render data를 받는다\n            />\n            {Array.isArray(data.engine_result.engine_result.pos_map) && cornerstoneRenderData && (\n              <HeatmapViewer\n                width={width}\n                height={height}\n                posMap={data.engine_result.engine_result.pos_map}\n                threshold={0.1}\n                cornerstoneRenderData={cornerstoneRenderData} // Render data를 전달한다\n              />\n            )}\n          </InsightViewerContainer>\n        )}\n      </InsightViewerTestController>\n    </div>\n  );\n};\n","export default \"import {\\n  CornerstoneImage,\\n  CornerstoneSingleImage,\\n  CornerstoneViewer,\\n  HeatmapViewer,\\n  InsightViewerContainer,\\n  InsightViewerControllerOptions,\\n  InsightViewerTestController,\\n  installWADOImageLoader,\\n  unloadImage,\\n  useInsightViewerSync,\\n} from '@lunit/insight-viewer';\\nimport React, { useMemo } from 'react';\\nimport data from '../../../__fixtures__/posMap.sample.json';\\n\\ninstallWADOImageLoader();\\n\\nconst controllerOptions: InsightViewerControllerOptions = {\\n  width: [600, 400, 1000],\\n  height: [700, 400, 1000],\\n  control: ['pan', ['none', 'pan', 'adjust']],\\n  wheel: ['zoom', ['none', 'zoom']],\\n  flip: [false],\\n  invert: [false],\\n};\\n\\nexport default () => {\\n  const image: CornerstoneImage = useMemo(\\n    () =>\\n      new CornerstoneSingleImage(`wadouri:https://fixtures.front.lunit.io/dcm-files/series/CT000010.dcm`, {\\n        unload: unloadImage,\\n      }),\\n    [],\\n  );\\n\\n  const { cornerstoneRenderData, updateCornerstoneRenderData } = useInsightViewerSync();\\n\\n  return (\\n    <div>\\n      <InsightViewerTestController options={controllerOptions}>\\n        {({ width, height, invert, flip, control, wheel, resetTime, element, setElement, interactions }) => (\\n          <InsightViewerContainer ref={setElement} width={width} height={height}>\\n            <CornerstoneViewer\\n              width={width}\\n              height={height}\\n              invert={invert}\\n              flip={flip}\\n              interactions={interactions}\\n              resetTime={resetTime}\\n              image={image}\\n              updateCornerstoneRenderData={updateCornerstoneRenderData} // Render data를 받는다\\n            />\\n            {Array.isArray(data.engine_result.engine_result.pos_map) && cornerstoneRenderData && (\\n              <HeatmapViewer\\n                width={width}\\n                height={height}\\n                posMap={data.engine_result.engine_result.pos_map}\\n                threshold={0.1}\\n                cornerstoneRenderData={cornerstoneRenderData} // Render data를 전달한다\\n              />\\n            )}\\n          </InsightViewerContainer>\\n        )}\\n      </InsightViewerTestController>\\n    </div>\\n  );\\n};\\n\"","\nimport React from 'react'\nimport { mdx } from '@mdx-js/react'\n\n/* @jsx mdx */\nimport { component, source } from '@handbook/source';\nimport { Example } from '@handbook/components';\nimport { InsightViewerPreview } from '@lunit/handbook';\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  \n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n    <h1><inlineCode parentName=\"h1\">{`<HeatmapViewer>`}</inlineCode></h1>\n    <p>{`AI에서 내려받는 Heatmap 데이터 형식을 화면에 그린다.`}</p>\n    <h1>{`API`}</h1>\n    <Example example={source('@lunit/insight-viewer/components/HeatmapViewer')} api mdxType=\"Example\" />\n    <h1>{`Sample`}</h1>\n    <Example example={component('./HeatmapViewer/Basic')} mdxType=\"Example\">\n  <InsightViewerPreview height={720} mdxType=\"InsightViewerPreview\" />\n    </Example>\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"],"sourceRoot":""}